// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

model User {
    id              Int               @id @default(autoincrement())
    email           String            @unique
    password        String
    isAdmin         Boolean           @default(false)
    branchCreated   Branch[]
    atmCreated      ATM[]
    districtCreated District[]
    clusterCreated  Cluster[]
    tunnelRange     TunnelRange[]
    LANRange        LANRange[]
    LeasedBranchIps LeasedBranchIps[]
    LeasedATMIps    LeasedATMIps[]

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@index([email])
}

model Branch {
    id           Int              @id @default(autoincrement())
    name         String
    district     District         @relation(fields: [districtId], references: [id])
    districtId   Int
    wanAddress   String
    remark       String
    ipWithTunnel LeasedBranchIps?
    createdBy    User             @relation(fields: [userId], references: [id])
    userId       Int

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@index([name])
}

model ATM {
    id              Int           @id @default(autoincrement())
    name            String
    district        District      @relation(fields: [districtId], references: [id])
    districtId      Int
    wanAddress      String
    loopBackAddress String
    isOutlet        Boolean       @default(false)
    remark          String
    LeasedATMIps    LeasedATMIps?
    createdBy       User          @relation(fields: [userId], references: [id])
    userId          Int

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@index([name])
}

model District {
    id                Int          @id @default(autoincrement())
    name              String       @unique
    branches          Branch[]
    ATM               ATM[]
    cluster           Cluster?     @relation(fields: [clusterId], references: [id])
    clusterId         Int?
    usableTunnelRange TunnelRange? @relation(fields: [tunnelRangeId], references: [id])
    tunnelRangeId     Int?
    usableLANRange    LANRange?    @relation(fields: [lanRangeId], references: [id])
    lanRangeId        Int?
    createdBy         User         @relation(fields: [userId], references: [id])
    userId            Int

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@index([name])
}

model Cluster {
    id        Int        @id @default(autoincrement())
    name      String     @unique
    districts District[]
    createdBy User       @relation(fields: [userId], references: [id])
    userId    Int

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@index([name])
}

model TunnelRange {
    id          Int        @id @default(autoincrement())
    clusterName String
    lowerLimit  String     @unique
    upperLimit  String     @unique
    createdBy   User       @relation(fields: [userId], references: [id])
    userId      Int
    District    District[]

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

model LANRange {
    id          Int        @id @default(autoincrement())
    clusterName String
    lowerLimit  String     @unique
    upperLimit  String     @unique
    createdBy   User       @relation(fields: [userId], references: [id])
    userId      Int
    District    District[]

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

model LeasedBranchIps {
    id              Int          @id @default(autoincrement())
    isTaken         Boolean
    isReserved      Boolean
    authorizedBy    User         @relation(fields: [userId], references: [id])
    remark          String
    lanIpAddress    AllLANIps    @relation(fields: [allLANIpsId], references: [id])
    allLANIpsId     Int          @unique
    tunnelIpAddress AllTunnelIps @relation(fields: [tunnelIpId], references: [id])
    tunnelIpId      Int          @unique
    branch          Branch       @relation(fields: [assignedToId], references: [id])
    assignedToId    Int          @unique
    userId          Int

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

model LeasedATMIps {
    id              Int          @id @default(autoincrement())
    // assignedTo      String
    authorizedBy    User         @relation(fields: [userId], references: [id])
    remark          String
    lanIpAddress    AllLANIps    @relation(fields: [allLANIpsId], references: [id])
    allLANIpsId     Int          @unique
    tunnelIpAddress AllTunnelIps @relation(fields: [tunnelIpId], references: [id])
    tunnelIpId      Int          @unique
    atm             ATM          @relation(fields: [atmId], references: [id])
    atmId           Int          @unique
    userId          Int

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

model AllLANIps {
    id              Int              @id @default(autoincrement())
    isTaken         Boolean          @default(false)
    isReserved      Boolean          @default(false)
    isFlagged       Boolean          @default(false)
    ipAddress       String           @unique
    LeasedBranchIps LeasedBranchIps?
    LeasedATMIps    LeasedATMIps?

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

model AllTunnelIps {
    id               Int              @id @default(autoincrement())
    isTaken          Boolean          @default(false)
    isReserved       Boolean          @default(false)
    isFlagged        Boolean          @default(false)
    TunnelIP_DR_ER11 String           @unique
    TunnelIP_DR_ER12 String           @unique
    TunnelIP_DC_ER21 String           @unique
    TunnelIP_DC_ER22 String           @unique
    LeasedBranchIps  LeasedBranchIps?
    LeasedATMIps     LeasedATMIps?

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}
