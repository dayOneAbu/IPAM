// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

model User {
    id            Int           @id @default(autoincrement())
    email         String        @unique
    password      String
    isAdmin       Boolean       @default(false)
    branchCreated Branch[]
    ATMCreated    ATM[]
    createdAt     DateTime      @default(now())
    updatedAt     DateTime      @updatedAt
    District      District[]
    Cluster       Cluster[]
    TunnelRange   TunnelRange[]
    LANRange      LANRange[]

    @@index([email])
}

model Branch {
    id           Int              @id @default(autoincrement())
    name         String
    district     District         @relation(fields: [districtId], references: [id])
    districtId   Int
    wanAddress   String
    remark       String
    ipWithTunnel LeasedBranchIps?
    createdBy    User             @relation(fields: [userId], references: [id])
    userId       Int
    createdAt    DateTime         @default(now())
    updatedAt    DateTime         @updatedAt

    @@index([name])
}

model ATM {
    id              Int           @id @default(autoincrement())
    name            String
    district        District      @relation(fields: [districtId], references: [id])
    districtId      Int
    wanAddress      String
    loopBackAddress String
    isOutlet        Boolean       @default(false)
    remark          String
    LeasedATMIps    LeasedATMIps?
    createdBy       User          @relation(fields: [userId], references: [id])
    userId          Int
    createdAt       DateTime      @default(now())
    updatedAt       DateTime      @updatedAt

    @@index([name])
}

model District {
    id                Int          @id @default(autoincrement())
    name              String
    branches          Branch[]
    ATM               ATM[]
    Cluster           Cluster?     @relation(fields: [clusterId], references: [id])
    clusterId         Int?
    usableTunnelRange TunnelRange? @relation(fields: [tunnelRangeId], references: [id])
    tunnelRangeId     Int?
    usableLANRange    LANRange?    @relation(fields: [lanRangeId], references: [id])
    lanRangeId        Int?
    createdAt         DateTime     @default(now())
    updatedAt         DateTime     @updatedAt
    createdBy         User         @relation(fields: [userId], references: [id])
    userId            Int

    @@index([name])
}

model Cluster {
    id        Int        @id @default(autoincrement())
    name      String
    districts District[]
    createdAt DateTime   @default(now())
    updatedAt DateTime   @updatedAt
    createdBy User       @relation(fields: [userId], references: [id])
    userId    Int

    @@index([name])
}

model TunnelRange {
    id         Int        @id @default(autoincrement())
    lowerLimit String
    upperLimit String
    districts  District[]
    createdAt  DateTime   @default(now())
    updatedAt  DateTime   @updatedAt
    createdBy  User       @relation(fields: [userId], references: [id])
    userId     Int
}

model LANRange {
    id         Int        @id @default(autoincrement())
    lowerLimit String
    upperLimit String
    districts  District[]
    createdAt  DateTime   @default(now())
    updatedAt  DateTime   @updatedAt
    createdBy  User       @relation(fields: [userId], references: [id])
    userId     Int
}

model LeasedBranchIps {
    id               Int     @id @default(autoincrement())
    isTaken          Boolean
    isReserved       Boolean
    assignedTo       String
    authoredBy       String
    remark           String
    TunnelIP_DR_ER11 String
    TunnelIP_DR_ER12 String
    TunnelIP_DC_ER21 String
    TunnelIP_DC_ER22 String

    branch    Branch   @relation(fields: [branchId], references: [id])
    branchId  Int      @unique
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

model LeasedATMIps {
    id               Int     @id @default(autoincrement())
    isTaken          Boolean
    isReserved       Boolean
    assignedTo       String
    authoredBy       String
    remark           String
    TunnelIP_DR_ER11 String
    TunnelIP_DR_ER12 String
    TunnelIP_DC_ER21 String
    TunnelIP_DC_ER22 String

    atm       ATM      @relation(fields: [atmId], references: [id])
    atmId     Int      @unique
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}
