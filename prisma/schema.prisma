// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

model User {
    id              Int               @id @default(autoincrement())
    email           String            @unique
    password        String
    isAdmin         Boolean           @default(false)
    branchCreated   Branch[]
    ATMCreated      ATM[]
    District        District[]
    Cluster         Cluster[]
    TunnelRange     TunnelRange[]
    LANRange        LANRange[]
    LeasedBranchIps LeasedBranchIps[]
    LeasedATMIps    LeasedATMIps[]

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@index([email])
}

model Branch {
    id           Int              @id @default(autoincrement())
    name         String
    district     District         @relation(fields: [districtId], references: [id])
    districtId   Int
    wanAddress   String
    remark       String
    ipWithTunnel LeasedBranchIps?
    createdBy    User             @relation(fields: [userId], references: [id])
    userId       Int

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@index([name])
}

model ATM {
    id              Int           @id @default(autoincrement())
    name            String
    district        District      @relation(fields: [districtId], references: [id])
    districtId      Int
    wanAddress      String
    loopBackAddress String
    isOutlet        Boolean       @default(false)
    remark          String
    LeasedATMIps    LeasedATMIps?
    createdBy       User          @relation(fields: [userId], references: [id])
    userId          Int

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@index([name])
}

model District {
    id                Int          @id @default(autoincrement())
    name              String
    branches          Branch[]
    ATM               ATM[]
    Cluster           Cluster?     @relation(fields: [clusterId], references: [id])
    clusterId         Int?
    usableTunnelRange TunnelRange? @relation(fields: [tunnelRangeId], references: [id])
    tunnelRangeId     Int?
    usableLANRange    LANRange?    @relation(fields: [lanRangeId], references: [id])
    lanRangeId        Int?
    createdBy         User         @relation(fields: [userId], references: [id])
    userId            Int

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@index([name])
}

model Cluster {
    id        Int        @id @default(autoincrement())
    name      String
    districts District[]
    createdBy User       @relation(fields: [userId], references: [id])
    userId    Int

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@index([name])
}

model TunnelRange {
    id         Int        @id @default(autoincrement())
    lowerLimit String
    upperLimit String
    createdBy  User       @relation(fields: [userId], references: [id])
    userId     Int
    District   District[]

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

model LANRange {
    id         Int        @id @default(autoincrement())
    lowerLimit String
    upperLimit String
    createdBy  User       @relation(fields: [userId], references: [id])
    userId     Int
    District   District[]

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

model LeasedBranchIps {
    id              Int          @id @default(autoincrement())
    isTaken         Boolean
    isReserved      Boolean
    authorizedBy    User         @relation(fields: [userId], references: [id])
    remark          String
    lanIpAddress    AllLANIps    @relation(fields: [allLANIpsId], references: [id])
    allLANIpsId     Int
    tunnelIpAddress AllTunnelIps @relation(fields: [tunnelIpId], references: [id])
    tunnelIpId      Int          @unique
    branch          Branch       @relation(fields: [assignedToId], references: [id])
    assignedToId    Int          @unique
    userId          Int

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

model LeasedATMIps {
    id              Int          @id @default(autoincrement())
    assignedTo      String
    authorizedBy    User         @relation(fields: [userId], references: [id])
    remark          String
    lanIpAddress    AllLANIps    @relation(fields: [allLANIpsId], references: [id])
    allLANIpsId     Int
    tunnelIpAddress AllTunnelIps @relation(fields: [tunnelIpId], references: [id])
    tunnelIpId      Int          @unique
    atm             ATM          @relation(fields: [atmId], references: [id])
    atmId           Int          @unique
    userId          Int

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

model AllLANIps {
    id              Int               @id @default(autoincrement())
    isTaken         Boolean
    isReserved      Boolean
    ipAddress       String
    subnetMask      String
    LeasedATMIps    LeasedATMIps[]
    LeasedBranchIps LeasedBranchIps[]

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

model AllTunnelIps {
    id               Int              @id @default(autoincrement())
    isTaken          Boolean
    isReserved       Boolean
    TunnelIP_DR_ER11 String
    TunnelIP_DR_ER12 String
    TunnelIP_DC_ER21 String
    TunnelIP_DC_ER22 String
    LeasedBranchIps  LeasedBranchIps?
    LeasedATMIps     LeasedATMIps?

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}
